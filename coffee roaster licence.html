<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Application for Coffee Roaster's Licence</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
      background: #f5f9f5;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #2c3e50;
      background-color: #4CAF50;
      color: white;
      padding: 15px;
      border-radius: 8px;
    }
    h2 {
      color: #2c6e3c;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 5px;
      margin-top: 30px;
    }
    label {
      display: block;
      margin: 12px 0 5px;
      font-weight: bold;
    }
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    textarea,
    input[type="date"],
    select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 16px;
      margin-bottom: 5px;
    }
    input[type="file"] {
      margin-top: 5px;
      padding: 8px;
      border: 1px dashed #4CAF50;
      border-radius: 6px;
      background-color: #f9f9f9;
      width: 100%;
    }
    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .checkbox-group {
      display: flex;
      gap: 20px;
      margin: 10px 0;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 14px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      width: 100%;
      transition: background-color 0.3s;
      margin-top: 20px;
    }
    button:hover {
      background-color: #3e8e41;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .required {
      color: red;
    }
    .form-note {
      font-size: 14px;
      color: #666;
      font-style: italic;
      margin-top: 5px;
    }
    .success-message {
      display: none;
      background-color: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 6px;
      margin: 20px 0;
      text-align: center;
      font-weight: bold;
    }
    .error-message {
      display: none;
      background-color: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 6px;
      margin: 20px 0;
      text-align: center;
      font-weight: bold;
    }
    .address-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .director-group {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }
    .declaration-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }
    @media (max-width: 600px) {
      .address-group,
      .director-group,
      .declaration-group {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <h1>Application for a Coffee Roaster's Licence</h1>
  
  <div class="success-message" id="successMessage">
    Your application has been submitted successfully!
  </div>
  
  <div class="error-message" id="errorMessage">
    There was an error submitting your application. Please try again.
  </div>

  <form id="roasterForm" action="submit_coffee_roaster_application.php" method="POST">
    <div class="section">
      <h2>1. Applicant Information</h2>
      
      <label>Name of Applicant: <span class="required">*</span></label>
      <input type="text" name="applicant_name" required>

      <div class="address-group">
        <div>
          <label>Postal Address: <span class="required">*</span></label>
          <input type="text" name="postal_address" required>
        </div>
        
        <div>
          <label>Postal Code: <span class="required">*</span></label>
          <input type="text" name="postal_code" required>
        </div>
        
        <div>
          <label>Registered Address: <span class="required">*</span></label>
          <input type="text" name="registered_address" required>
        </div>
        
        <div>
          <label>Building: <span class="required">*</span></label>
          <input type="text" name="building" required>
        </div>
        
        <div>
          <label>Street: <span class="required">*</span></label>
          <input type="text" name="street" required>
        </div>
        
        <div>
          <label>Town/City: <span class="required">*</span></label>
          <input type="text" name="town_city" required>
        </div>
        
        <div>
          <label>L.R. No.: <span class="required">*</span></label>
          <input type="text" name="lr_no" required>
        </div>
        
        <div>
          <label>Mobile No.: <span class="required">*</span></label>
          <input type="tel" name="mobile_no" required>
        </div>
        
        <div>
          <label>Email: <span class="required">*</span></label>
          <input type="email" name="email" required>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>2. Company Information (If applicable)</h2>
      
      <label>Name of Company:</label>
      <input type="text" name="company_name">
      
      <div class="address-group">
        <div>
          <label>Date of Incorporation:</label>
          <input type="date" name="date_incorporation">
        </div>
        
        <div>
          <label>Registration No.:</label>
          <input type="text" name="registration_no">
        </div>
      </div>
    </div>

    <div class="section">
      <h2>3. Directors</h2>
      <p>Provide full names, addresses and occupations of directors:</p>
      
      <div class="director-group">
        <div>
          <label>Name:</label>
          <input type="text" name="director_name_1">
        </div>
        
        <div>
          <label>Address:</label>
          <input type="text" name="director_address_1">
        </div>
        
        <div>
          <label>Occupation:</label>
          <input type="text" name="director_occupation_1">
        </div>
      </div>
      
      <div class="director-group">
        <div>
          <label>Name:</label>
          <input type="text" name="director_name_2">
        </div>
        
        <div>
          <label>Address:</label>
          <input type="text" name="director_address_2">
        </div>
        
        <div>
          <label>Occupation:</label>
          <input type="text" name="director_occupation_2">
        </div>
      </div>
      
      <div class="director-group">
        <div>
          <label>Name:</label>
          <input type="text" name="director_name_3">
        </div>
        
        <div>
          <label>Address:</label>
          <input type="text" name="director_address_3">
        </div>
        
        <div>
          <label>Occupation:</label>
          <input type="text" name="director_occupation_3">
        </div>
      </div>
    </div>

    <div class="section">
      <h2>4. Branch Office(s)</h2>
      
      <div class="address-group">
        <div>
          <label>Postal Address:</label>
          <input type="text" name="branch_postal">
        </div>
        
        <div>
          <label>Postal Code:</label>
          <input type="text" name="branch_postal_code">
        </div>
        
        <div>
          <label>Building:</label>
          <input type="text" name="branch_building">
        </div>
        
        <div>
          <label>Street:</label>
          <input type="text" name="branch_street">
        </div>
        
        <div>
          <label>Town/City:</label>
          <input type="text" name="branch_city">
        </div>
        
        <div>
          <label>L.R. No.:</label>
          <input type="text" name="branch_lr_no">
        </div>
        
        <div>
          <label>Mobile No.:</label>
          <input type="tel" name="branch_mobile">
        </div>
        
        <div>
          <label>Email:</label>
          <input type="email" name="branch_email">
        </div>
      </div>
    </div>

    <div class="section">
      <h2>5. Declaration</h2>
      
      <label>Date: <span class="required">*</span></label>
      <input type="date" name="declaration_date" required>
      
      <div class="declaration-group">
        <div>
          <label>Name of Director:</label>
          <input type="text" name="declaration_director_1">
        </div>
        
        <div>
          <label>Signature:</label>
          <input type="text" name="signature_1">
        </div>
      </div>
      
      <div class="declaration-group">
        <div>
          <label>Name of Director:</label>
          <input type="text" name="declaration_director_2">
        </div>
        
        <div>
          <label>Signature:</label>
          <input type="text" name="signature_2">
        </div>
      </div>
      
      <div class="declaration-group">
        <div>
          <label>Name of Director:</label>
          <input type="text" name="declaration_director_3">
        </div>
        
        <div>
          <label>Signature:</label>
          <input type="text" name="signature_3">
        </div>
      </div>
    </div>

    <div class="section">
      <h2>6. Authorized Officer</h2>
      
      <div class="address-group">
        <div>
          <label>Name:</label>
          <input type="text" name="authorized_name">
        </div>
        
        <div>
          <label>Physical Address:</label>
          <input type="text" name="authorized_address">
        </div>
        
        <div>
          <label>Mobile Number:</label>
          <input type="tel" name="authorized_mobile">
        </div>
      </div>
    </div>

    <button type="submit">Submit Application</button>
  </form>

  <script>
    // Set today's date as default for declaration date
    function setDefaultDate() {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      const todayFormatted = `${year}-${month}-${day}`;
      
      const dateInput = document.querySelector('input[name="declaration_date"]');
      if (dateInput) {
        dateInput.value = todayFormatted;
      }
    }

    // Enhanced form submission handling with AJAX
document.getElementById("formId").addEventListener("submit", async function(event) {
    event.preventDefault();
    
    console.log("Form submission started...");

    // Show loading state
    const submitBtn = document.getElementById('submitButton') || this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
    submitBtn.disabled = true;

    // Hide previous messages
    document.getElementById('successMessage').style.display = 'none';
    document.getElementById('errorMessage').style.display = 'none';

    try {
        const formData = new FormData(this);
        console.log("Sending form data to server...");
        
        const response = await fetch('submit_handler.php', { // Replace with actual handler
            method: 'POST',
            body: formData
        });
        
        console.log("Response status:", response.status);
        const result = await response.json();
        console.log("Server response:", result);
        
        if (result.success) {
            console.log("Submission successful!");
            
            // Show success message
            const successMessage = document.getElementById('successMessage');
            successMessage.innerHTML = 
                `Your application has been submitted successfully!<br>
                 Reference Number: <strong>${result.ref_number}</strong><br>
                 Application ID: ${result.application_id}`;
            successMessage.style.display = 'block';
            
            // Reset form
            this.reset();
            setDefaultDates(); // If you have this function
            
            console.log("Form reset, redirecting in 3 seconds...");
            
            // Redirect after 3 seconds
            setTimeout(() => {
                window.location.href = 'track.html';
            }, 3000);
            
        } else {
            throw new Error(result.message);
        }
    } catch (error) {
        console.error("Submission error:", error);
        document.getElementById('errorMessage').textContent = 
            'Error: ' + error.message;
        document.getElementById('errorMessage').style.display = 'block';
    } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
});
  </script>
</body>
</html>